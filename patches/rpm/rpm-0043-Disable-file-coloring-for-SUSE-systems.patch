From 3d5e4de9195a787f58b8c95cfa08c75872ba4959 Mon Sep 17 00:00:00 2001
From: Thorsten Otto <admin@tho-otto.de>
Date: Thu, 15 Mar 2018 05:52:09 +0100
Subject: [PATCH 43/63] Disable file coloring for SUSE systems

---
 build/rpmfc.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/build/rpmfc.c b/build/rpmfc.c
index 2fbfc69ab..e9f2490d2 100644
--- a/build/rpmfc.c
+++ b/build/rpmfc.c
@@ -1411,7 +1411,8 @@ rpmRC rpmfcGenerateDepends(const rpmSpec spec, Package pkg)
     /* XXX Make sure only primary (i.e. Elf32/Elf64) colors are added. */
     for (int i = 0; i < fc->nfiles; i++)
 	fc->fcolor[i] &= 0x0f;
-    headerPutUint32(pkg->header, RPMTAG_FILECOLORS, fc->fcolor, fc->nfiles);
+    if (rpmExpandNumeric("%{?_transaction_color}") != 0)
+	headerPutUint32(pkg->header, RPMTAG_FILECOLORS, fc->fcolor, fc->nfiles);
     
     /* Add classes(#classes) */
     for (rpmsid id = 1; id <= rpmstrPoolNumStr(fc->cdict); id++) {
-- 
2.16.2

