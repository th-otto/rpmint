From ce77434bcfdea7c294ed15cf6e6b93aacd6e5430 Mon Sep 17 00:00:00 2001
From: Thorsten Otto <admin@tho-otto.de>
Date: Mon, 15 Apr 2024 13:42:46 +0200
Subject: [PATCH 1/2] python3-mintsetupdist

---
 Modules/Setup             | 93 ++++++++++++++++++++-------------------
 Modules/_hashopenssl.c    |  2 +
 Modules/_ssl.c            |  2 +
 Modules/_testcapimodule.c |  4 ++
 4 files changed, 56 insertions(+), 45 deletions(-)

diff --git a/Modules/Setup b/Modules/Setup
index d3647ec..241aa35 100644
--- a/Modules/Setup
+++ b/Modules/Setup
@@ -127,47 +127,48 @@ PYTHONPATH=$(COREPYTHONPATH)
 # detail; also note that *static* or *disabled* cancels this effect):
 
 #*shared*
+*static*
 
 # Modules that should always be present (POSIX and Windows):
 
 #_asyncio _asynciomodule.c
-#_bisect _bisectmodule.c
-#_contextvars _contextvarsmodule.c
-#_csv _csv.c
-#_datetime _datetimemodule.c
+_bisect _bisectmodule.c
+_contextvars _contextvarsmodule.c
+_csv _csv.c
+_datetime _datetimemodule.c
 #_decimal _decimal/_decimal.c
-#_heapq _heapqmodule.c
-#_json _json.c
-#_lsprof _lsprof.c rotatingtree.c
+_heapq _heapqmodule.c
+_json _json.c
+_lsprof _lsprof.c rotatingtree.c
 #_multiprocessing -I$(srcdir)/Modules/_multiprocessing _multiprocessing/multiprocessing.c _multiprocessing/semaphore.c
-#_opcode _opcode.c
-#_pickle _pickle.c
-#_queue _queuemodule.c
-#_random _randommodule.c
-#_socket socketmodule.c
-#_statistics _statisticsmodule.c
-#_struct _struct.c
-#_typing _typingmodule.c
-#_zoneinfo _zoneinfo.c
-#array arraymodule.c
-#audioop audioop.c
-#binascii binascii.c
+_opcode _opcode.c
+_pickle _pickle.c
+_queue _queuemodule.c
+_random _randommodule.c
+_socket socketmodule.c
+_statistics _statisticsmodule.c
+_struct _struct.c
+_typing _typingmodule.c
+_zoneinfo _zoneinfo.c
+array arraymodule.c
+audioop audioop.c
+binascii binascii.c
 #cmath cmathmodule.c
-#math mathmodule.c
+math mathmodule.c
 #mmap mmapmodule.c
-#select selectmodule.c
+select selectmodule.c
 
 # XML
-#_elementtree _elementtree.c
-#pyexpat pyexpat.c
+_elementtree _elementtree.c
+pyexpat pyexpat.c
 
 # hashing builtins
-#_blake2 _blake2/blake2module.c _blake2/blake2b_impl.c _blake2/blake2s_impl.c
-#_md5 md5module.c
-#_sha1 sha1module.c
-#_sha256 sha256module.c
-#_sha512 sha512module.c
-#_sha3 _sha3/sha3module.c
+_blake2 _blake2/blake2module.c _blake2/blake2b_impl.c _blake2/blake2s_impl.c
+_md5 md5module.c
+_sha1 sha1module.c
+_sha256 sha256module.c
+_sha512 sha512module.c
+_sha3 _sha3/sha3module.c
 
 # text encodings and unicode
 #_codecs_cn cjkcodecs/_codecs_cn.c
@@ -177,39 +178,39 @@ PYTHONPATH=$(COREPYTHONPATH)
 #_codecs_kr cjkcodecs/_codecs_kr.c
 #_codecs_tw cjkcodecs/_codecs_tw.c
 #_multibytecodec cjkcodecs/multibytecodec.c
-#unicodedata unicodedata.c
+unicodedata unicodedata.c
 
 # Modules with some UNIX dependencies
 
-#_posixsubprocess _posixsubprocess.c
+_posixsubprocess _posixsubprocess.c
 #_posixshmem -I$(srcdir)/Modules/_multiprocessing _multiprocessing/posixshmem.c -lrt
-#fcntl fcntlmodule.c
-#grp grpmodule.c
+fcntl fcntlmodule.c
+grp grpmodule.c
 #ossaudiodev ossaudiodev.c
-#resource resource.c
-#spwd spwdmodule.c
-#syslog syslogmodule.c
-#termios termios.c
+resource resource.c
+spwd spwdmodule.c
+syslog syslogmodule.c
+termios termios.c
 
 # Modules with UNIX dependencies that require external libraries
 
-#_crypt _cryptmodule.c -lcrypt
+_crypt _cryptmodule.c
 #nis nismodule.c -I/usr/include/tirpc -lnsl -ltirpc
 
 # Modules that require external libraries.
 
-#_bz2 _bz2module.c -lbz2
+_bz2 _bz2module.c -lbz2
 #_ctypes _ctypes/_ctypes.c _ctypes/callbacks.c _ctypes/callproc.c _ctypes/stgdict.c _ctypes/cfield.c -ldl -lffi -DHAVE_FFI_PREP_CIF_VAR -DHAVE_FFI_PREP_CLOSURE_LOC -DHAVE_FFI_CLOSURE_ALLOC
 # The _dbm module supports NDBM, GDBM with compat module, and Berkeley DB.
 #_dbm _dbmmodule.c -lgdbm_compat -DUSE_GDBM_COMPAT
 #_gdbm _gdbmmodule.c -lgdbm
 #_lzma _lzmamodule.c -llzma
 #_uuid _uuidmodule.c -luuid
-#zlib  zlibmodule.c -lz
+zlib  zlibmodule.c -lz
 
 # The readline module also supports libeditline (-leditline).
 # Some systems may require -ltermcap or -ltermlib.
-#readline readline.c -lreadline -ltermcap
+readline readline.c -lreadline -lncurses
 
 # OpenSSL bindings
 #_ssl _ssl.c $(OPENSSL_INCLUDES) $(OPENSSL_LDFLAGS) $(OPENSSL_LIBS)
@@ -244,7 +245,7 @@ PYTHONPATH=$(COREPYTHONPATH)
 # *** Or uncomment this for Solaris:
 #	-I/usr/openwin/include \
 # *** Uncomment and edit for Tix extension only:
-#	-DWITH_TIX -ltix8.1.8.2 \
+#	-DWITH_TIX -ltix4.1.0.6 \
 # *** Uncomment and edit for BLT extension only:
 #	-DWITH_BLT -I/usr/local/blt/blt8.0-unoff/include -lBLT8.0 \
 # *** Uncomment and edit for PIL (TkImaging) extension only:
@@ -264,8 +265,8 @@ PYTHONPATH=$(COREPYTHONPATH)
 #	-lX11
 
 # Some system have -lcurses 
-#_curses -lncurses -lncursesw -ltermcap _cursesmodule.c
-#_curses_panel -lpanel -lncurses _curses_panel.c
+_curses _cursesmodule.c -lncurses -lncursesw
+_curses_panel _curses_panel.c -lpanel -lncurses
 
 # macOS specific module, needs SystemConfiguration and CoreFoundation framework
 # _scproxy _scproxy.c
@@ -296,7 +297,9 @@ xxsubtype xxsubtype.c  # Required for the test suite to pass!
 # Uncommenting the following line tells makesetup that all following modules
 # are not built (see above for more detail).
 #
-#*disabled*
+*disabled*
 #
 # _sqlite3 _tkinter _curses pyexpat
 # _codecs_jp _codecs_kr _codecs_tw unicodedata
+_codecs_cn _codecs_hk _codecs_jp _codecs_kr _codecs_tw _codecs_iso2022
+_tkinter
diff --git a/Modules/_hashopenssl.c b/Modules/_hashopenssl.c
index 57d64bd..a0c62fe 100644
--- a/Modules/_hashopenssl.c
+++ b/Modules/_hashopenssl.c
@@ -39,9 +39,11 @@
 
 #include <openssl/crypto.h>       // FIPS_mode()
 
+#ifndef __MINT__
 #ifndef OPENSSL_THREADS
 #  error "OPENSSL_THREADS is not defined, Python requires thread-safe OpenSSL"
 #endif
+#endif
 
 #define MUNCH_SIZE INT_MAX
 
diff --git a/Modules/_ssl.c b/Modules/_ssl.c
index 67ce6e9..40d2151 100644
--- a/Modules/_ssl.c
+++ b/Modules/_ssl.c
@@ -61,9 +61,11 @@
 #include "openssl/bio.h"
 #include "openssl/dh.h"
 
+#ifndef __MINT__
 #ifndef OPENSSL_THREADS
 #  error "OPENSSL_THREADS is not defined, Python requires thread-safe OpenSSL"
 #endif
+#endif
 
 
 
diff --git a/Modules/_testcapimodule.c b/Modules/_testcapimodule.c
index a4411d1..21c0aa7 100644
--- a/Modules/_testcapimodule.c
+++ b/Modules/_testcapimodule.c
@@ -2658,6 +2658,9 @@ static int test_run_counter = 0;
 
 static PyObject *
 test_datetime_capi(PyObject *self, PyObject *args) {
+#ifdef Py_BUILD_CORE
+	Py_RETURN_NONE;
+#else
     if (PyDateTimeAPI) {
         if (test_run_counter) {
             /* Probably regrtest.py -R */
@@ -2676,6 +2679,7 @@ test_datetime_capi(PyObject *self, PyObject *args) {
         Py_RETURN_NONE;
     else
         return NULL;
+#endif
 }
 
 /* Functions exposing the C API type checking for testing */
-- 
2.41.0

