diff -rupN -x Makefile.in -x Makefile -x .deps -x configure -x missing -x depcomp -x config.h.in -x aclocal.m4 -x compile -x config.guess -x config.sub -x install-sh -x mkinstalldirs lmarbles-1.0.8.orig/configure.in lmarbles-1.0.8.new/configure.in
--- lmarbles-1.0.8.orig/configure.in	2009-10-26 20:56:06.000000000 +0100
+++ lmarbles-1.0.8.new/configure.in	2023-12-08 11:50:04.211226036 +0100
@@ -17,21 +17,19 @@ dnl check for libraries
 AC_CHECK_LIB(m, main,, AC_MSG_ERROR(lib math is needed))
 
 dnl check SDL version
-AM_PATH_SDL(1.0.0,, AC_MSG_ERROR(lib SDL is needed))
+PKG_CHECK_MODULES([SDL], [sdl], :, AC_MSG_ERROR(lib SDL is needed))
 CFLAGS="$CFLAGS $SDL_CFLAGS"
 LIBS="$LIBS $SDL_LIBS"
-AM_PATH_SDL(1.1.5, CFLAGS="$CFLAGS -DSDL_1_1_5",)
 
 dnl check sound
 sound_flag="-DSOUND"
-mixer_flag="-lSDL_mixer"
 AC_ARG_ENABLE( sound,
 [  --disable-sound         Disables sound], sound_flag=""; mixer_flag="")
 
 dnl check if SDL_mixer's installed
 dnl if not: clear sound_flag and mixer_flag
-AC_CHECK_LIB(SDL_mixer, main,
-AC_MSG_RESULT("SDL_Mixer found"),
+PKG_CHECK_MODULES([SDL_MIXER], [SDL_mixer],
+AC_MSG_RESULT("SDL_Mixer found"); mixer_flag="$SDL_MIXER_LIBS",
 AC_MSG_RESULT("SDL_Mixer NOT found: Audio disabled"); sound_flag=""; mixer_flag="")
 
 AC_SUBST(sound_flag)
@@ -44,8 +42,8 @@ AC_ARG_ENABLE( ascii,
 AC_SUBST(ascii_flag)
 
 dnl installation & prefix path
-inst_dir="$datadir/lmarbles"
-prf_dir=$localstatedir
+inst_dir='${datadir}/lmarbles'
+prf_dir='${localstatedir}'
 
 dnl check if installation was disabled
 AC_ARG_ENABLE( install,
diff -rupN -x Makefile.in -x Makefile -x .deps -x configure -x missing -x depcomp -x config.h.in -x aclocal.m4 -x compile -x config.guess -x config.sub -x install-sh -x mkinstalldirs lmarbles-1.0.8.orig/src/Makefile.am lmarbles-1.0.8.new/src/Makefile.am
--- lmarbles-1.0.8.orig/src/Makefile.am	2004-06-09 14:27:18.000000000 +0200
+++ lmarbles-1.0.8.new/src/Makefile.am	2023-12-08 13:14:00.431064374 +0100
@@ -1,4 +1,5 @@
 DEFS = @DEFS@ @arch_flag@ @inst_flag@ @prf_flag@ @sound_flag@ @ascii_flag@
+AM_CFLAGS = -Wall
 
 marblesres.o: win32.ico 
 	@echo "1 VERSIONINFO" > $(PACKAGE).rc
diff -rupN -x Makefile.in -x Makefile -x .deps -x configure -x missing -x depcomp -x config.h.in -x aclocal.m4 -x compile -x config.guess -x config.sub -x install-sh -x mkinstalldirs lmarbles-1.0.8.orig/src/cfg.c lmarbles-1.0.8.new/src/cfg.c
--- lmarbles-1.0.8.orig/src/cfg.c	2004-06-09 14:32:45.000000000 +0200
+++ lmarbles-1.0.8.new/src/cfg.c	2023-12-08 12:46:06.846669990 +0100
@@ -43,7 +43,7 @@ void C_StPth()
 #ifdef _WIN32
     snprintf( c_pth, sizeof(c_pth)-1, "%s/lgames", (getenv( "HOME" )?getenv( "HOME" ):".") );
 #else
-    snprintf( c_pth, sizeof(c_pth)-1, "%s/.lgames", getenv( "HOME" ) );
+    strcpy( c_pth, ".");
 #endif
     /* create .lgames directory if not found */
     if ( (dir = opendir( c_pth )) == 0 ) {
@@ -70,19 +70,12 @@ void C_Ld()
     printf("loading configuration...\n");
 
     // load init //
-    if ((f = fopen(c_pth, "r")) == 0) {
+    if ((f = fopen(c_pth, "rb")) == 0) {
         printf("cfg file '%s' not found; using defaults\n", c_pth);
         C_Def();
 	}
     else {
         stat( c_pth, &dir_stat );
-        if ( dir_stat.st_size != sizeof( Cfg ) ) {
-            fprintf( stderr, "config file '%s' corrupted... using defaults\n", c_pth );
-            C_Def();
-        }
-        else
-            
-        {
 #ifdef ASCII
 
         F_GetE(f, str, F_VAL);
@@ -112,6 +105,13 @@ void C_Ld()
         }
 #else
 
+        if ( dir_stat.st_size != sizeof( Cfg ) ) {
+            fprintf( stderr, "config file '%s' corrupted... using defaults\n", c_pth );
+            C_Def();
+        }
+        else
+            
+        {
         fread(str, 5, 1, f);
         if (!strncmp(str,"ascii",5)) {
 
@@ -126,8 +126,8 @@ void C_Ld()
 
         }
 
-#endif		
         }
+#endif		
         
 		fclose(f);
 	}
@@ -139,8 +139,14 @@ void C_Ld()
 void C_Sv()
 {
     //save init //
-    FILE	*f = fopen(c_pth, "w");
+    FILE	*f = fopen(c_pth, "wb");
+    if (!f)
+    {
+        printf("WARNING: no write access to %s\n", c_pth);
+    	return;
+    }
 #ifdef ASCII
+{
     char    str[256];
 
     F_WrtE(f, "ascii");
@@ -158,6 +164,7 @@ void C_Sv()
     F_IntToStr(str, cfg.k_left); F_WrtE(f, str);
     F_IntToStr(str, cfg.k_right); F_WrtE(f, str);
     F_IntToStr(str, cfg.k_undo); F_WrtE(f, str);
+}
 #else
     fwrite(&cfg, sizeof(Cfg), 1, f);
 #endif
diff -rupN -x Makefile.in -x Makefile -x .deps -x configure -x missing -x depcomp -x config.h.in -x aclocal.m4 -x compile -x config.guess -x config.sub -x install-sh -x mkinstalldirs lmarbles-1.0.8.orig/src/dynlist.c lmarbles-1.0.8.new/src/dynlist.c
--- lmarbles-1.0.8.orig/src/dynlist.c	2000-11-21 19:39:52.000000000 +0100
+++ lmarbles-1.0.8.new/src/dynlist.c	2023-12-08 11:37:58.412242092 +0100
@@ -136,7 +136,7 @@ int DL_DelP(DLst *dlst, void *item)
                 break;
         }
         else {
-            fprintf(stderr, "ERR: dl_delete: list does not contain item 0x%x...\n", (int)item);
+            fprintf(stderr, "ERR: dl_delete: list does not contain item %p...\n", item);
             return 1;
         }
 
@@ -247,7 +247,7 @@ DL_E *DL_GetE(DLst *dlst, void *item)
                 break;
         }
         else {
-            fprintf(stderr, "ERR: DL_GetE: list does not contain item 0x%x...\n", (int)item);
+            fprintf(stderr, "ERR: DL_GetE: list does not contain item %p...\n", item);
             return 0;
         }
 
diff -rupN -x Makefile.in -x Makefile -x .deps -x configure -x missing -x depcomp -x config.h.in -x aclocal.m4 -x compile -x config.guess -x config.sub -x install-sh -x mkinstalldirs lmarbles-1.0.8.orig/src/file.c lmarbles-1.0.8.new/src/file.c
--- lmarbles-1.0.8.orig/src/file.c	2001-03-04 14:20:42.000000000 +0100
+++ lmarbles-1.0.8.new/src/file.c	2023-12-08 13:23:34.436950818 +0100
@@ -27,10 +27,10 @@ int f_ln = 0;
 void F_GetE(FILE *f, char *str, int flgs)
 {
     int i = 0;
-    char c;
+    int c;
     str[0] = 0;
-    while (!feof(f)) {
-        fread(&c, 1/*sizeof(char)*/, 1, f); /* MUST BE exactly on byte */
+    while ((c = fgetc(f)) != EOF) {
+        if (c == 13) continue;
         if (c == 10) {
             f_ln++; // increase line counter //
             continue; // ignore returns //
@@ -53,7 +53,11 @@ char F_FstC(char *str, char **n)
     int i = 0;
     while (str[i] <= 32) {
         i++;
-        if (i >= strlen(str)) return 0;
+        if (i >= strlen(str))
+        {
+    		*n = str + i;
+        	return 0;
+        }
     }
     *n = str + i;
     return str[i];
@@ -83,7 +87,8 @@ int F_GetV(char *str, char *v)
         if (str[i] == '=') {
             F_FstC(str + i + 1, &n);
             strcpy(v, n);
-            v[strlen(v) - 1] = 0; // mask semicolon
+            i = (int)strlen(v);
+            if (i > 0) v[i - 1] = 0; // mask semicolon
             return 1;
         }
     return 0;
diff -rupN -x Makefile.in -x Makefile -x .deps -x configure -x missing -x depcomp -x config.h.in -x aclocal.m4 -x compile -x config.guess -x config.sub -x install-sh -x mkinstalldirs lmarbles-1.0.8.orig/src/game.c lmarbles-1.0.8.new/src/game.c
--- lmarbles-1.0.8.orig/src/game.c	2005-09-14 18:49:54.000000000 +0200
+++ lmarbles-1.0.8.new/src/game.c	2023-12-08 13:17:47.670755684 +0100
@@ -173,7 +173,7 @@ void G_Ini()
     for (i = 0; i < ls_n; i++) {
         printf("%s... ", ls_lst[i]);
         sprintf(str, "%s/levels/%s", SRC_DIR, ls_lst[i]);
-        f = fopen(str, "r");
+        f = fopen(str, "rb");
         if (f != 0) {
             f_ln = 1;
             if (L_LdSt(f)) {
@@ -279,17 +279,17 @@ void G_Ini()
     gm.c_u = gm.c_d = gm.c_l = gm.c_r = gm.c_s = gm.c_w = 0;
     gm.c_n = SDL_GetCursor();
     Cr_Ld(csr[0], data, mask);
-    gm.c_u = SDL_CreateCursor(data, mask, 16, 16, 8, 8);
+    gm.c_u = SDL_CreateCursor((Uint8 *)data, (Uint8 *)mask, 16, 16, 8, 8);
     Cr_Ld(csr[1], data, mask);
-    gm.c_d = SDL_CreateCursor(data, mask, 16, 16, 8, 8);
+    gm.c_d = SDL_CreateCursor((Uint8 *)data, (Uint8 *)mask, 16, 16, 8, 8);
     Cr_Ld(csr[2], data, mask);
-    gm.c_r = SDL_CreateCursor(data, mask, 16, 16, 8, 8);
+    gm.c_r = SDL_CreateCursor((Uint8 *)data, (Uint8 *)mask, 16, 16, 8, 8);
     Cr_Ld(csr[3], data, mask);
-    gm.c_l = SDL_CreateCursor(data, mask, 16, 16, 8, 8);
+    gm.c_l = SDL_CreateCursor((Uint8 *)data, (Uint8 *)mask, 16, 16, 8, 8);
     Cr_Ld(csr[4], data, mask);
-    gm.c_s = SDL_CreateCursor(data, mask, 16, 16, 8, 8);
+    gm.c_s = SDL_CreateCursor((Uint8 *)data, (Uint8 *)mask, 16, 16, 8, 8);
     Cr_Ld(csr[5], data, mask);
-    gm.c_w = SDL_CreateCursor(data, mask, 16, 16, 8, 8);
+    gm.c_w = SDL_CreateCursor((Uint8 *)data, (Uint8 *)mask, 16, 16, 8, 8);
 
     // map animations
     gm.m_ani = 0;
@@ -705,7 +705,7 @@ void G_Run()
 void G_LdGSts()
 {
     char    d_nm[256];
-    char    path[256+64];
+    char    path[512+64];
     DIR     *dir = 0;
     struct dirent  *e;
     struct stat     s;
@@ -1710,6 +1710,8 @@ void Mr_Act()
             gm.c_stat = C_L;
             break;
     }
+    (void)x_a;
+    (void)y_a;
     if (ow) {
 /*        mx += x_a; my += y_a;
         while (gm.c_lvl->map[mx][my].m != -1) {
diff -rupN -x Makefile.in -x Makefile -x .deps -x configure -x missing -x depcomp -x config.h.in -x aclocal.m4 -x compile -x config.guess -x config.sub -x install-sh -x mkinstalldirs lmarbles-1.0.8.orig/src/levels.c lmarbles-1.0.8.new/src/levels.c
--- lmarbles-1.0.8.orig/src/levels.c	2002-08-08 05:19:05.000000000 +0200
+++ lmarbles-1.0.8.new/src/levels.c	2023-12-08 13:19:34.443943973 +0100
@@ -52,7 +52,7 @@ void L_CrtLst()
 {
     int     i;
     char    d_nm[256];
-    char    path[256+64];
+    char    path[512+64];
     DIR     *dir = 0;
     struct dirent  *e;
     struct stat     s;
diff -rupN -x Makefile.in -x Makefile -x .deps -x configure -x missing -x depcomp -x config.h.in -x aclocal.m4 -x compile -x config.guess -x config.sub -x install-sh -x mkinstalldirs lmarbles-1.0.8.orig/src/lmarbles.conf lmarbles-1.0.8.new/src/lmarbles.conf
--- lmarbles-1.0.8.orig/src/lmarbles.conf	1970-01-01 01:00:00.000000000 +0100
+++ lmarbles-1.0.8.new/src/lmarbles.conf	2023-12-08 13:01:32.042081011 +0100
@@ -0,0 +1 @@
+ascii;Michael;0;6;1;1;1;0;1;1;273;274;276;275;32;
\ No newline at end of file
diff -rupN -x Makefile.in -x Makefile -x .deps -x configure -x missing -x depcomp -x config.h.in -x aclocal.m4 -x compile -x config.guess -x config.sub -x install-sh -x mkinstalldirs lmarbles-1.0.8.orig/src/lmarbles.prfs lmarbles-1.0.8.new/src/lmarbles.prfs
--- lmarbles-1.0.8.orig/src/lmarbles.prfs	1970-01-01 01:00:00.000000000 +0100
+++ lmarbles-1.0.8.new/src/lmarbles.prfs	2023-12-08 13:01:32.042081011 +0100
@@ -0,0 +1 @@
+ascii;1;Michael;0;0;0.00;0;
\ No newline at end of file
diff -rupN -x Makefile.in -x Makefile -x .deps -x configure -x missing -x depcomp -x config.h.in -x aclocal.m4 -x compile -x config.guess -x config.sub -x install-sh -x mkinstalldirs lmarbles-1.0.8.orig/src/profile.c lmarbles-1.0.8.new/src/profile.c
--- lmarbles-1.0.8.orig/src/profile.c	2004-06-14 10:15:02.000000000 +0200
+++ lmarbles-1.0.8.new/src/profile.c	2023-12-08 13:18:55.563996788 +0100
@@ -65,7 +65,7 @@ int Prf_Ld()
     printf("loading profiles... ");
 
     // read access ? //
-    if ((f = fopen(prf_pth, "r")) == 0) {
+    if ((f = fopen(prf_pth, "rb")) == 0) {
         printf("\nWARNING: file %s does not exist; cannot read profiles\n", prf_pth);
         Prf_Crt("Michael");
         not_f = 1;
@@ -75,7 +75,7 @@ int Prf_Ld()
 #ifdef ASCII
         F_GetE(f, str, F_VAL); str[strlen(str) - 1] = 0;
         if (strncmp(str,"ascii",5)) {
-            printf("\nWARNING: trying to load raw binary data in ascii; cannot read profiles\n", prf_pth);
+            printf("\nWARNING: trying to load raw binary data in ascii; cannot read profiles\n");
             Prf_Crt("Michael");
             not_f = 1;
         }
@@ -183,7 +183,7 @@ void Prf_Sv()
 #endif
 
     printf("saving profiles... ");
-    if ((f = fopen(prf_pth, "w")) == 0) {
+    if ((f = fopen(prf_pth, "wb")) == 0) {
         printf("WARNING: no write access to %s\n", prf_pth);
     }
     else {
diff -rupN -x Makefile.in -x Makefile -x .deps -x configure -x missing -x depcomp -x config.h.in -x aclocal.m4 -x compile -x config.guess -x config.sub -x install-sh -x mkinstalldirs lmarbles-1.0.8.orig/src/sdl.c lmarbles-1.0.8.new/src/sdl.c
--- lmarbles-1.0.8.orig/src/sdl.c	2002-08-08 04:37:50.000000000 +0200
+++ lmarbles-1.0.8.new/src/sdl.c	2023-12-08 12:29:51.367980633 +0100
@@ -100,12 +100,12 @@ void SS_End(SDL_Surface *sur)
 */
 void SS_Blt(void)
 {
-#ifdef SDL_1_1_5
+#if SDL_VERSION_ATLEAST(1, 1, 5)
     if (sdl.s.s->flags & SDL_SRCALPHA)
         SDL_SetAlpha(sdl.s.s, SDL_SRCALPHA, 255 - sdl.s.s->format->alpha);
 #endif
     SDL_BlitSurface(sdl.s.s, &sdl.s.r, sdl.d.s, &sdl.d.r);
-#ifdef SDL_1_1_5
+#if SDL_VERSION_ATLEAST(1, 1, 5)
     if (sdl.s.s->flags & SDL_SRCALPHA)
         SDL_SetAlpha(sdl.s.s, SDL_SRCALPHA, 255 - sdl.s.s->format->alpha);
 #endif
@@ -116,7 +116,7 @@ void SS_Blt(void)
 */
 void SS_ABlt(int alpha)
 {
- #ifdef SDL_1_1_5
+#if SDL_VERSION_ATLEAST(1, 1, 5)
     SDL_SetAlpha(sdl.s.s, SDL_SRCALPHA, 255 - alpha);
 #else
     SDL_SetAlpha(sdl.s.s, SDL_SRCALPHA, alpha);
@@ -172,7 +172,7 @@ SFnt* SF_Ld(char *fname)
     fnt->h = fnt->ss->h;
 	
     //table
-    file = fopen(path, "r");
+    file = fopen(path, "rb");
     fseek(file, -1, SEEK_END);
     fread(&fnt->off, 1, 1, file);
 #ifdef DEBUG
