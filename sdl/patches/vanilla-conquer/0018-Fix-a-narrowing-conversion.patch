From 9b4c0cd45516a9c8c43e531b4701b5388a859c2c Mon Sep 17 00:00:00 2001
From: Thorsten Otto <admin@tho-otto.de>
Date: Tue, 19 Mar 2024 18:43:40 +0100
Subject: [PATCH 18/40] Fix a narrowing conversion

---
 redalert/defines.h      |  8 ++---
 redalert/function.h     |  2 +-
 redalert/init.cpp       |  8 ++---
 redalert/target.h       |  2 +-
 tiberiandawn/defines.h  | 78 ++++++++++++++++++++---------------------
 tiberiandawn/function.h |  2 +-
 tiberiandawn/init.cpp   |  2 +-
 tiberiandawn/target.h   |  2 +-
 8 files changed, 52 insertions(+), 52 deletions(-)

diff --git a/redalert/defines.h b/redalert/defines.h
index 22b218b..9863a5c 100644
--- a/redalert/defines.h
+++ b/redalert/defines.h
@@ -205,7 +205,7 @@ extern int RESFACTOR;
 **	Enable the set of limited cheat key options.
 */
 #ifdef VIRGIN_CHEAT_KEYS
-#define PARM_PLAYTEST 0xF7DDC227 // "PLAYTEST"
+#define PARM_PLAYTEST 0xF7DDC227UL // "PLAYTEST"
 #endif
 
 /*
@@ -213,11 +213,11 @@ extern int RESFACTOR;
 */
 #ifdef CHEAT_KEYS
 #ifndef PARM_PLAYTEST
-#define PARM_PLAYTEST 0xF7DDC227 // "PLAYTEST"
+#define PARM_PLAYTEST 0xF7DDC227UL // "PLAYTEST"
 #endif
 #endif
 
-#define PARM_INSTALL 0xD95C68A2 //	"FROMINSTALL"
+#define PARM_INSTALL 0xD95C68A2UL //	"FROMINSTALL"
 
 /**********************************************************************
 **	Defines for verifying free disk space
@@ -3609,4 +3609,4 @@ typedef struct
 // Maximum number of teams
 #define MAX_TEAMS 10
 
-#endif
\ No newline at end of file
+#endif
diff --git a/redalert/function.h b/redalert/function.h
index 3fcc580..e1df7fa 100644
--- a/redalert/function.h
+++ b/redalert/function.h
@@ -378,7 +378,7 @@ bool Read_Scenario_INI_Write_INB(char* root, bool fresh);
 **	INIT.CPP
 */
 void Load_Title_Page(bool visible = false);
-int Obfuscate(char const* string);
+uint32_t Obfuscate(char const* string);
 void Anim_Init(void);
 bool Init_Game(int argc, char* argv[]);
 bool Select_Game(bool fade = false);
diff --git a/redalert/init.cpp b/redalert/init.cpp
index 0650af7..f3acf28 100644
--- a/redalert/init.cpp
+++ b/redalert/init.cpp
@@ -1382,12 +1382,12 @@ bool Parse_Command_Line(int argc, char* argv[])
         }
 
         bool processed = true;
-        unsigned ob = unsigned(Obfuscate(string));
+        uint32_t ob = Obfuscate(string);
 
         /*
         **	Check to see if the parameter is a cheat enabling one.
         */
-        unsigned const* optr = &CheatCodes[0];
+        uint32_t const* optr = &CheatCodes[0];
         while (*optr) {
             if (*optr++ == ob) {
                 Debug_Playtest = true;
@@ -1627,7 +1627,7 @@ bool Parse_Command_Line(int argc, char* argv[])
  * HISTORY:                                                                                    *
  *   08/19/1995 JLB : Created.                                                                 *
  *=============================================================================================*/
-int Obfuscate(char const* string)
+uint32_t Obfuscate(char const* string)
 {
     char buffer[1024];
 
diff --git a/redalert/target.h b/redalert/target.h
index 494a735..d73055f 100644
--- a/redalert/target.h
+++ b/redalert/target.h
@@ -165,7 +165,7 @@ public:
     void Invalidate(void)
     {
         Target.Sub.Exponent = RTTI_NONE;
-        Target.Sub.Mantissa = -1;
+        Target.Sub.Mantissa = (1UL << TARGET_MANTISSA) - 1;
     }
     bool Is_Valid(void) const
     {
diff --git a/tiberiandawn/defines.h b/tiberiandawn/defines.h
index f69fc69..ee9f875 100644
--- a/tiberiandawn/defines.h
+++ b/tiberiandawn/defines.h
@@ -111,47 +111,47 @@
 #ifndef PARM_PLAYTEST
 #define PARM_PLAYTEST 0xF7DDC227 // "PLAYTEST"
 #endif
-#define PARM_CHEATDAVID   0xBE79088C // Cheat keys for David Dettmer
-#define PARM_CHEATERIK    0x9F38A19D // Cheat keys for Erik Yeo
-#define PARM_EDITORERIK   0xC2AA509B //	Map editor for Erik Yeo
-#define PARM_CHEATPHIL    0x39D01821 // Cheat keys for Phil Gorrow
-#define PARM_CHEATJOE     0xABDD0362 // Cheat keys for Joe Bostic
-#define PARM_CHEATBILL    0xB5B63531 // Cheat keys for Bill Randolph
-#define PARM_CHEAT_STEVET 0x2E7FE493 // Cheat keys for Steve Tall
-#define PARM_EDITORBILL   0x7E7C4CCA //	"-EDITOR"
-#define PARM_CHEATMIKE    0x00532693 // Mike Lightner
-#define PARM_CHEATADAM    0xDFABC23A // Adam Isgreen
+#define PARM_CHEATDAVID   0xBE79088CUL // Cheat keys for David Dettmer
+#define PARM_CHEATERIK    0x9F38A19DUL // Cheat keys for Erik Yeo
+#define PARM_EDITORERIK   0xC2AA509BUL //	Map editor for Erik Yeo
+#define PARM_CHEATPHIL    0x39D01821UL // Cheat keys for Phil Gorrow
+#define PARM_CHEATJOE     0xABDD0362UL // Cheat keys for Joe Bostic
+#define PARM_CHEATBILL    0xB5B63531UL // Cheat keys for Bill Randolph
+#define PARM_CHEAT_STEVET 0x2E7FE493UL // Cheat keys for Steve Tall
+#define PARM_EDITORBILL   0x7E7C4CCAUL //	"-EDITOR"
+#define PARM_CHEATMIKE    0x00532693UL // Mike Lightner
+#define PARM_CHEATADAM    0xDFABC23AUL // Adam Isgreen
 #endif
 
-//#define	PARM_CHEAT		0x6F4BE7CA		// "CHEAT"
-//#define	PARM_EDITOR		0x7E7C4CCA		//	"-EDITOR"
-
-#define PARM_EASY 0x59E975CE // "EASY" Enables easy mode.
-#define PARM_HARD 0xACFE9D13 // "HARD" Enables hard mode.
-
-#define PARM_INSTALL    0xD95C68A2 //	"FROMINSTALL"
-#define PARM_TRUENAME   0xB1A34435 // Enables true object names.
-#define PARM_3POINT     0x03552894 // Enable three point turns.
-#define PARM_SCORE      0x7FDE2C33 // Enables alternate themes.
-#define PARM_COMBAT     0xDC57C4B2 // Gives combat advantage to attacker.
-#define PARM_TREETARGET 0x00AB6BEF // Allows targeting of trees without <CTRL> key.
-#define PARM_BIB        0xF7867BF0 // Disables building bibs.
-#define PARM_MCV        0x104DF10F // MCV undeploys rather than sells.
-#define PARM_HELIPAD    0x53EBECBC // Helipad can be purchased separately from helicopter.
-#define PARM_IQ         0x9E3881B8 // Smart self defense logic enable.
-#define PARM_SQUISH     0x4EA2FBDF // Squish images for infantry bodies.
-#define PARM_HUMAN      0xACB58F61 // Human generated sound effects.
-#define PARM_SCROLLING  0xC084AE82 // Restricts scrolling over the tabs.
-//#define	PARM_SPECIAL		0xD18129F6		// Enables special mode.
-//#define	PARM_SPECIAL	0x2E84E394	//	#1
-//#define	PARM_SPECIAL	0x63CE7584	//	#2
-//#define	PARM_SPECIAL	0x85F110A5	//	#3
-///#define	PARM_SPECIAL	0x7F65F13C	//	#4
-//#define	PARM_SPECIAL	0x431F5F61	//	#5
+//#define	PARM_CHEAT		0x6F4BE7CAUL		// "CHEAT"
+//#define	PARM_EDITOR		0x7E7C4CCAUL		//	"-EDITOR"
+
+#define PARM_EASY 0x59E975CEUL // "EASY" Enables easy mode.
+#define PARM_HARD 0xACFE9D13UL // "HARD" Enables hard mode.
+
+#define PARM_INSTALL    0xD95C68A2UL //	"FROMINSTALL"
+#define PARM_TRUENAME   0xB1A34435UL // Enables true object names.
+#define PARM_3POINT     0x03552894UL // Enable three point turns.
+#define PARM_SCORE      0x7FDE2C33UL // Enables alternate themes.
+#define PARM_COMBAT     0xDC57C4B2UL // Gives combat advantage to attacker.
+#define PARM_TREETARGET 0x00AB6BEFUL // Allows targeting of trees without <CTRL> key.
+#define PARM_BIB        0xF7867BF0UL // Disables building bibs.
+#define PARM_MCV        0x104DF10FUL // MCV undeploys rather than sells.
+#define PARM_HELIPAD    0x53EBECBCUL // Helipad can be purchased separately from helicopter.
+#define PARM_IQ         0x9E3881B8UL // Smart self defense logic enable.
+#define PARM_SQUISH     0x4EA2FBDFUL // Squish images for infantry bodies.
+#define PARM_HUMAN      0xACB58F61UL // Human generated sound effects.
+#define PARM_SCROLLING  0xC084AE82UL // Restricts scrolling over the tabs.
+//#define	PARM_SPECIAL		0xD18129F6UL		// Enables special mode.
+//#define	PARM_SPECIAL	0x2E84E394UL	//	#1
+//#define	PARM_SPECIAL	0x63CE7584UL	//	#2
+//#define	PARM_SPECIAL	0x85F110A5UL	//	#3
+///#define	PARM_SPECIAL	0x7F65F13CUL	//	#4
+//#define	PARM_SPECIAL	0x431F5F61UL	//	#5
 #define PARM_SPECIAL 0x11CA05BB //	#6 	funpark
-//#define	PARM_SPECIAL	0xE0F651B9	//	#7
-//#define	PARM_SPECIAL	0x10B9683D	//	#8
-//#define	PARM_SPECIAL	0xEE1CD37D	//	#9
+//#define	PARM_SPECIAL	0xE0F651B9UL	//	#7
+//#define	PARM_SPECIAL	0x10B9683DUL	//	#8
+//#define	PARM_SPECIAL	0xEE1CD37DUL	//	#9
 
 /**********************************************************************
 **	Defines for verifying free disk space
@@ -3043,4 +3043,4 @@ typedef enum StrategyType : unsigned char
 
 #pragma warning(pop)
 
-#endif
\ No newline at end of file
+#endif
diff --git a/tiberiandawn/function.h b/tiberiandawn/function.h
index 454679a..55a68b6 100644
--- a/tiberiandawn/function.h
+++ b/tiberiandawn/function.h
@@ -493,7 +493,7 @@ int Scan_Place_Object(ObjectClass* obj, CELL cell);
 **	INIT.CPP
 */
 void Uninit_Game(void);
-long Obfuscate(char const* string);
+uint32_t Obfuscate(char const* string);
 void Anim_Init(void);
 bool Init_Game(int argc, char* argv[]);
 bool Select_Game(bool fade = false);
diff --git a/tiberiandawn/init.cpp b/tiberiandawn/init.cpp
index e1cced9..5ae4fd5 100644
--- a/tiberiandawn/init.cpp
+++ b/tiberiandawn/init.cpp
@@ -2318,7 +2318,7 @@ void Load_Recording_Values(void)
  * HISTORY:                                                                                    *
  *   08/19/1995 JLB : Created.                                                                 *
  *=============================================================================================*/
-long Obfuscate(char const* string)
+uint32_t Obfuscate(char const* string)
 {
     char buffer[1024];
 
diff --git a/tiberiandawn/target.h b/tiberiandawn/target.h
index 4a4e65f..9b1bd7f 100644
--- a/tiberiandawn/target.h
+++ b/tiberiandawn/target.h
@@ -183,7 +183,7 @@ public:
     void Invalidate(void)
     {
         Target.Sub.Exponent = RTTI_NONE;
-        Target.Sub.Mantissa = -1;
+        Target.Sub.Mantissa = (1UL << TARGET_MANTISSA) - 1;
     }
     bool Is_Valid(void) const
     {
-- 
2.41.0

